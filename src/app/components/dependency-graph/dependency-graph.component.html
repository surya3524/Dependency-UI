<div class="dependency-graph">
  <!-- Header -->
  <div class="graph-header">
    <div class="header-content">
      <h4>Dependency graph</h4>
    </div>
    <div class="header-actions">
      <button class="btn-primary" (click)="exportGraph()">
        <i class="icon-export">üìä</i>
        Export Graph
      </button>
      <button class="btn-secondary" (click)="exportData()">
        <i class="icon-download">‚¨áÔ∏è</i>
        Export Data
      </button>
    </div>
  </div>

  <!-- Controls Panel -->
  <div class="controls-panel">
    <div class="control-group">
      <label>Layout:</label>
      <select [(ngModel)]="selectedLayout" (change)="changeLayout(selectedLayout)" class="control-select">
        <option *ngFor="let layout of layouts" [value]="layout.name">
          {{ layout.displayName }}
        </option>
      </select>
    </div>

    <div class="control-group">
      <label>Search:</label>
      <input 
        type="text" 
        [(ngModel)]="searchQuery" 
        (input)="applyFilters()"
        placeholder="Search services..."
        class="control-input"
      >
    </div>

    

    <div class="control-group">
      <label class="checkbox-label">
        <input type="checkbox" [(ngModel)]="showLabels" (change)="toggleLabels()">
        Show Labels
      </label>
    </div>

    <div class="control-group">
      <label class="checkbox-label">
        <input type="checkbox" [(ngModel)]="showEdgeLabels" (change)="toggleEdgeLabels()">
        Show Edge Labels
      </label>
    </div>

    <div class="control-group">
      <label class="checkbox-label">
        <input type="checkbox" [(ngModel)]="showMetrics" (change)="toggleMetrics()">
        Show Metrics
      </label>
    </div>

    <div class="control-group">
      <button class="btn-clear" (click)="clearFilters()">Clear Filters</button>
    </div>
  </div>

  <!-- Graph Container -->
  <div class="graph-container">
    <div #graphContainer class="cytoscape-container"></div>
    
    <!-- Graph Controls Overlay -->
    <div class="graph-controls-overlay">
      <div class="zoom-controls">
        <button class="control-btn" (click)="resetZoom()" title="Reset Zoom">
          <i class="icon-reset">üîÑ</i>
        </button>
        <button class="control-btn" (click)="fitToScreen()" title="Fit to Screen">
          <i class="icon-fit">üìê</i>
        </button>
      </div>
    </div>
  </div>

  <!-- Statistics Panel -->
  <div class="stats-panel">
    <div class="stat-item">
      <span class="stat-label">Nodes:</span>
      <span class="stat-value">{{ totalNodes }}</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">Edges:</span>
      <span class="stat-value">{{ totalEdges }}</span>
    </div>
    <div class="stat-item">
      <span class="stat-label">Layout:</span>
      <span class="stat-value">{{ selectedLayout }}</span>
    </div>
  </div>

  <!-- Selection Details Panel -->
  <div class="details-panel" *ngIf="selectedNode || selectedEdge">
    <div class="details-header">
      <h3>{{ selectedNode ? 'Service Details' : 'Dependency Details' }}</h3>
      <button class="close-btn" (click)="selectedNode = null; selectedEdge = null">√ó</button>
    </div>
    
    <div class="details-content" *ngIf="selectedNode">
      <div class="detail-section">
        <h4>{{ selectedNode.data('name') }}</h4>
        <div class="detail-grid">
          <div class="detail-item">
            <span class="detail-label">Type:</span>
            <span class="detail-value">{{ getServiceTypeLabel(selectedNode.data('type')) }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Status:</span>
            <span class="detail-value status-badge" [class]="selectedNode.data('status').toLowerCase()">
              {{ getStatusLabel(selectedNode.data('status')) }}
            </span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Criticality:</span>
            <span class="detail-value criticality-badge" [class]="selectedNode.data('criticality').toLowerCase()">
              {{ getCriticalityLabel(selectedNode.data('criticality')) }}
            </span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Environment:</span>
            <span class="detail-value">{{ selectedNode.data('environment') }}</span>
          </div>
          <div class="detail-item" *ngIf="selectedNode.data('team')">
            <span class="detail-label">Team:</span>
            <span class="detail-value">{{ selectedNode.data('team') }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Dependencies:</span>
            <span class="detail-value">{{ selectedNode.data('dependencies') }}</span>
          </div>
        </div>
      </div>
      
      <div class="detail-section" *ngIf="showMetrics">
        <h4>Metrics</h4>
        <div class="metrics-grid">
          <div class="metric-item" *ngIf="selectedNode.data('uptime')">
            <span class="metric-label">Uptime:</span>
            <span class="metric-value">{{ selectedNode.data('uptime') }}%</span>
          </div>
          <div class="metric-item" *ngIf="selectedNode.data('responseTime')">
            <span class="metric-label">Response Time:</span>
            <span class="metric-value">{{ selectedNode.data('responseTime') }}ms</span>
          </div>
          <div class="metric-item" *ngIf="selectedNode.data('errorRate')">
            <span class="metric-label">Error Rate:</span>
            <span class="metric-value">{{ selectedNode.data('errorRate') }}%</span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="details-content" *ngIf="selectedEdge">
      <div class="detail-section">
        <h4>{{ getDependencyTypeLabel(selectedEdge.data('type')) }}</h4>
        <div class="detail-grid">
          <div class="detail-item">
            <span class="detail-label">Source:</span>
            <span class="detail-value">{{ selectedEdge.source().data('name') }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Target:</span>
            <span class="detail-value">{{ selectedEdge.target().data('name') }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Usage Count:</span>
            <span class="detail-value">{{ selectedEdge.data('usageCount') }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Weight:</span>
            <span class="detail-value">{{ selectedEdge.data('weight') }}/10</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Frequency:</span>
            <span class="detail-value">{{ selectedEdge.data('frequency') }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Critical:</span>
            <span class="detail-value">{{ selectedEdge.data('isCritical') ? 'Yes' : 'No' }}</span>
          </div>
          <div class="detail-item">
            <span class="detail-label">Active:</span>
            <span class="detail-value">{{ selectedEdge.data('isActive') ? 'Yes' : 'No' }}</span>
          </div>
          <div class="detail-item" *ngIf="selectedEdge.data('latency')">
            <span class="detail-label">Latency:</span>
            <span class="detail-value">{{ selectedEdge.data('latency') }}ms</span>
          </div>
          <div class="detail-item" *ngIf="selectedEdge.data('errorRate')">
            <span class="detail-label">Error Rate:</span>
            <span class="detail-value">{{ selectedEdge.data('errorRate') }}%</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Legend -->
  <!-- <div class="legend-panel">
    <h4>Legend</h4>
    
    <div class="legend-section">
      <h5>Node Colors (Status)</h5>
      <div class="legend-items">
        <div class="legend-item">
          <div class="legend-color" style="background-color: #10b981;"></div>
          <span>Active</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background-color: #ef4444;"></div>
          <span>Inactive/Error</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background-color: #f59e0b;"></div>
          <span>Deprecated</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background-color: #3b82f6;"></div>
          <span>Maintenance</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background-color: #6b7280;"></div>
          <span>Unknown</span>
        </div>
      </div>
    </div>

    <div class="legend-section">
      <h5>Edge Colors (Type)</h5>
      <div class="legend-items">
        <div class="legend-item">
          <div class="legend-color" style="background-color: #667eea;"></div>
          <span>HTTP Request</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background-color: #10b981;"></div>
          <span>Database Query</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background-color: #f59e0b;"></div>
          <span>Message Queue</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background-color: #ef4444;"></div>
          <span>API Call</span>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background-color: #3b82f6;"></div>
          <span>Direct Dependency</span>
        </div>
      </div>
    </div>

    <div class="legend-section">
      <h5>Node Size</h5>
      <p>Larger nodes have more dependencies</p>
  </div>

    <div class="legend-section">
      <h5>Edge Width</h5>
      <p>Thicker edges indicate higher usage</p>
  </div>
  </div> -->
</div>
